---
import VideoCard from "../../components/VideoCard.astro";
import Layout from "../../layouts/Layout.astro";
import { CollectionEntry, getCollection } from "astro:content";
import { sortCollectionByDate } from "../../lib/utils";
import Timeago from "../../components/Timeago.astro";

export async function getStaticPaths() {
  const posts = await getCollection("videos");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
}
type Props = CollectionEntry<"videos">;

const video = Astro.props;
const { title, youtube_id, author, author_url, author_avatar_url } = video.data;

const videos = (await getCollection("videos")).sort(sortCollectionByDate).slice(0, 8);
---

<Layout title={title}>
  <section class="container mx-auto py-4">
    <div class="relative overflow-hidden bg-gray-600 sm:my-6 sm:rounded-xl">
      <div class="relative aspect-video">
        <img
          src={`https://img.youtube.com/vi/${youtube_id}/maxresdefault.jpg`}
          alt={title}
          class="absolute inset-0 h-full w-full object-cover"
        />
        <iframe
          class="absolute inset-0 h-full w-full"
          src={`https://www.youtube.com/embed/${youtube_id}?rel=0&autoplay=1`}
          allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen></iframe>
      </div>
      <div class="px-6 py-8">
        <h1 class="mb-4 font-display text-lg font-bold sm:text-3xl">
          {title}
        </h1>
        <p class="flex flex-wrap items-center gap-2">
          {
            author_avatar_url && (
              <img src={author_avatar_url} alt={author} class="mr-2 inline-block h-8 w-8 rounded-full" />
            )
          }
          <span
            >by <a href={author_url} target="_blank" rel="noopener noreferrer" class="font-semibold hover:underline">
              {author}
            </a></span
          >
          &middot;
          <Timeago date={video.data.date} />
        </p>
      </div>
    </div>
    <div class="grid gap-4 p-4 sm:grid-cols-2 sm:p-0 lg:grid-cols-3 xl:grid-cols-4">
      {videos.map((video) => <VideoCard entry={video} />)}
    </div>
  </section>
</Layout>
