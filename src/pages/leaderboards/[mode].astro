---
export const prerender = false
import Layout from "../../layouts/Layout.astro"
import Widget from "../../components/Widget.astro"
import hero from "../../assets/game/vanguard-base-hero.jpg"
import { Image } from "astro:assets"
import Leaderboard from "../../components/widgets/Leaderboard.astro"
import { LeaderboardsApi } from "../../lib/api"

const mode = Astro.params.mode
const perPage = 100
// todo, mode as query param
const { page, query } = Object.fromEntries(new URL(Astro.request.url).searchParams.entries())
const leaderboard = await LeaderboardsApi.getLeaderboard({ count: perPage, page: page ? +page : undefined, query })
const totalPages = 10 //Math.ceil(leaderboard.count / perPage)
---

<Layout title="Leaderboard">
  <div class="fixed top-0 -z-0 h-[max(800px,90vh)] w-full">
    <Image src={hero} alt="" class="absolute h-full w-full object-cover" />
    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-gray-950"></div>
  </div>
  <section class="relative mx-auto max-w-screen-md px-4 py-8">
    <Widget title="Global Leaderboard" label="Closed Beta Ranked">
      <Leaderboard entries={leaderboard.entries} />
    </Widget>
    <div class="my-2 flex justify-center gap-2">
      {
        Array.from({ length: totalPages }, (_, i) => i + 1).map((page) => (
          <a
            href={`?page=${page}`}
            class={`px-2 py-1 rounded-md text-sm font-medium ${
              page === +page ? "bg-gray-900 text-white" : "bg-gray-800 text-gray-300"
            }`}
          >
            {page}
          </a>
        ))
      }
    </div>
  </section>
</Layout>
